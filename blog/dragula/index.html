<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>Adding weight to drag and drop in macOS Finder</title>
  <meta name="description" content="I made Dragula, an extension to macOS Finder that adds weight to drag and drop.">

  <!-- Recommended minimum -->
  <meta property="og:title" content="p.b. to">
  <meta property="og:description" content="p.b. to's personal website">
  <meta property="og:image" content="img/og.png">
  <meta name="twitter:card" content="summary_large_image">

  <!-- You could also inline the stylesheet -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&family=Courier+Prime:ital@1&family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/_/style.css">
</head>

<body class="post">
  <header>
    <a href="/">
      <h1 class="name">p.b. to</h1>
    </a>
    <p class="slogan">sure, why not?</p>
    <p class="slogan"><a href="https://github.com/pbt/dragula">source code</a></p>
  </header>
  <article>
    <h1>Adding weight to drag and drop in<br> macOS Finder</h1>
    <aside>
      <p>
        <time datetime="2024-03-04">2024-03-04</time>
      </p><br>
      <a href="https://share.cleanshot.com/Gz9S9WXy">
        <img
          style="border-radius: var(--gap); border: 1px solid var(--highlight); object-fit: cover; aspect-ratio: 1.8; width: 100%; padding: 0;"
          alt="a demo of Dragula, a weighted-drag-and-drop experiment" src="img/demo.gif">
        <p style="text-align: center;"><small>Full Video (<strong>SOUND ON!</strong>)</small></p>
      </a>
    </aside>

    <p>
      I made <strong>Dragula</strong>, a highly experimental extension to macOS that adds weight to one of the oldest
      user interface
      interactions ever: The Finder&rsquo;s
      drag-and-drop interaction.
    </p>

    <p>In the world of Dragula, when you drag a file (or files), you will find
      it easier if the files are smaller in size, and harder if they are larger in size. A small GIF is easy to drag;
      you can likely move one across the screen while barely moving
      your mouse. But you might find it nigh impossible to move a large file, like a movie or the Xcode IDE. </p>

    <p>Indeed, in the
      world of Dragula, <em>every
        drag-and-drop interaction involving files is weighted</em>: individual files, folders, and even Finder windows.
    </p>

    <p>You can view the <a href="https://github.com/pbt/dragula">source code</a>, or read on below to see why I did this
      and how I did it.</p>

    <h2>Why did I make this?</h2>
    <p>Drag-and-drop has been a mainstay of
      personal
      computing since <a href="https://folklore.org/A_Floppy_named_lsadkfjalhkjh.html?sort=date?sort=date">it first
        showed up in the
        first Macintosh</a>.
      It&rsquo;s easy to see why: We drag things around a lot in real life! Direct manipulation is incredibly powerful
      and intuitive. It&rsquo;s so intuitive that there&rsquo;s evidence we <a
        href="https://dl.acm.org/doi/10.1145/2460625.2460650">spend more effort to move digital things that represent
        heavy
        real-life things</a>.

    <p>And yet, every drag-and-drop interaction is designed to feel the same, no matter what you&rsquo;re dragging.
      That made me curious: I wanted to
      play around with the conventions of drag and drop a little bit and see what that would feel like. Differentiating
      drag and drop based on file size seemed like a natural first step.</p>

    <p>Plus, I thought it would be fun.</p>
    <br>
    <img
      style="border-radius: var(--gap); border: 1px solid var(--highlight); object-fit: cover; aspect-ratio: 2; width: 100%; padding: 0;"
      src="img/weightlessness.png" alt="">
    <p style="display: block; text-align: center; width: 100%;">&ldquo;But
      Xcode&rsquo;s heavier
      than emojis!&rdquo; <small><a href="https://www.youtube.com/watch?v=-fC2oke5MFg">With apologies to
          Limmy.</a></small>
    </p>
    <h2>First sketches</h2>
    <p>From the get-go, my initial idea was to use macOS&rsquo; <a
        href="https://developer.apple.com/documentation/appkit/nsaccessibility">accessibility APIs.</a>
      In summary, accessiblity APIs are ways for assistive technologies, such as screen readers or adaptive controllers,
      to read what&rsquo;s on the screen, know when the user interacts, and
      perform actions on behalf of the user. These APIs are key to implementing accessible alternatives to a mouse,
      keyboard, or display, but they are also used by utilities that augment the macOS user interface. For example,
      Rectangle uses the accessibility API to implement window &ldquo;snapping&rdquo; by reading your mouse position
      while dragging a window, and then to resize the window itself.</p>

    <p>My initial idea followed from my experiences using Rectangle. When the user starts dragging a file, I would
      draw a fake proxy file on top of the icon. Then I could control the dragging interaction any way I wanted, since
      I would basically &ldquo;steal&rdquo; whatever was on Finder. (In retrospect, this seems a lot like the type of
      solution a React engineer would immediately reach for, doesn&rsquo;t it?)

    <p>As I was bouncing this idea around the <a href="https://recurse.com">Recurse Center</a> for a few weeks, we
      converged on a
      much
      simpler idea: Read the file size of whatever I was dragging, and then change the pointer speed as some factor of
      the file
      size. Not only was this much simpler, I knew it was workable because I knew of software that did this!
      Logi Options+ is an example of software that allow you to configure pointer speed
      via their UI and even remap the behavior of buttons. Once I could fit the pieces into my head, I felt motivated to
      implement it.
    </p>

    <h2>Implementing</h2>
    <p>I woke up bright and early (10am, I think) on a Monday, ready to get started. Because I was supposed to learn
      Rust,
      I only wanted to spend a week on this, so I set a goal to have a workable prototype that I could demo on the
      Thursday of
      the same week.

    <p>There was one hitch: I didn&rsquo;t really know how to use Swift, the preferred language for interfacing with
      the foundational APIs of macOS, including the Accessibility API and the input device API I wanted to use. Web
      searches on Google seemed pretty dire, surfacing
      only the official API documentation, which was very inaccessible, especially for an accessibility library.

    <p>So I changed my search strategy: I looked up &ldquo;macos open source mouse drivers&rdquo; and hoped that I would
      find
      something.
      And then I found LinearMouse, a really great mouse driver utility. Best of all, they had wrapped the input device
      code inside an easy-to-use library that was also easy to move to my project. And it worked for every pointing
      device,
      not just one manufacturer&rsquo;s product. Beautiful!

    <p>I found it really useful to start small. Once I had a sample app running with the pointer library, then I just
      tried changing it programmatically inside the code itself. Then I added the first bits of drag and drop, using
      code from Rectangle as reference. I also found it strangely useful to tackle things peripheral to the core
      functionality, such as the prompts to ask the user to enable accessibility permissions.

    <h2>How it works</h2>
    <p>The actual process is quite simple:

  </article>


</body>

</html>